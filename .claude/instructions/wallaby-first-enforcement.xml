<!-- Wallaby-First Testing Enforcement - CRITICAL Rule -->
<wallaby-first-enforcement priority="CRITICAL">
  <mandate>
    <rule>Wallaby.js MUST be running before writing or debugging any tests</rule>
    <exception>CI/CD environments only</exception>
    <enforcement>This rule overrides ALL other testing preferences</enforcement>
  </mandate>
  
  <workflow-requirements>
    <step priority="1">Open IDE with Wallaby plugin installed</step>
    <step priority="2">Start Wallaby.js (Cmd+Shift+R R in VS Code)</step>
    <step priority="3">Verify green indicators are showing</step>
    <step priority="4">Begin test development with instant feedback</step>
  </workflow-requirements>
  
  <terminal-blocking>
    <blocked-commands>
      <command reason="Use Wallaby instead">pnpm test (during development)</command>
      <command reason="Use Wallaby instead">vitest watch</command>
      <command reason="Use Wallaby instead">npm test -- --watch</command>
      <command reason="Use Wallaby instead">vitest --ui</command>
    </blocked-commands>
    <allowed-only>
      <scenario>CI pipeline execution</scenario>
      <scenario>Pre-commit hooks</scenario>
      <scenario>Performance benchmarking with test:find-slow</scenario>
      <scenario>Coverage report generation</scenario>
    </allowed-only>
  </terminal-blocking>
  
  <benefits-for-adhd>
    <benefit priority="1">Instant visual feedback (no terminal switching)</benefit>
    <benefit priority="2">Inline error messages (stay in code context)</benefit>
    <benefit priority="3">Runtime values visible (reduce debugging cognitive load)</benefit>
    <benefit priority="4">Coverage indicators (visual progress tracking)</benefit>
    <benefit priority="5">No command memorization (visual UI)</benefit>
  </benefits-for-adhd>
  
  <validation-checks>
    <check>Wallaby IDE extension installed</check>
    <check>wallaby.js configuration file present</check>
    <check>Tests discoverable by Wallaby</check>
    <check>Correct file naming patterns</check>
    <check>Exclusion patterns configured</check>
  </validation-checks>
  
  <error-messages>
    <terminal-usage>
      <title>ðŸš« CRITICAL VIOLATION: Terminal Testing Detected</title>
      <message>You are attempting to run tests in the terminal during development.</message>
      <required-action>
        1. Stop the terminal command immediately
        2. Open Wallaby.js in your IDE
        3. Use Wallaby for instant visual feedback
        4. Terminal is ONLY for CI/automated builds
      </required-action>
    </terminal-usage>
    
    <wallaby-not-running>
      <title>â›” Wallaby.js Not Active</title>
      <message>Test development requires Wallaby.js to be running.</message>
      <required-action>
        VS Code: Press Cmd+Shift+R R
        WebStorm: Run â†’ Wallaby.js â†’ Start
        Then verify green indicators before proceeding
      </required-action>
    </wallaby-not-running>
  </error-messages>
  
  <performance-requirements>
    <startup-time max="2000ms">Wallaby initialization</startup-time>
    <test-discovery max="500ms">Finding and loading tests</test-discovery>
    <feedback-latency max="300ms">Time from save to results</feedback-latency>
    <inline-display max="100ms">Showing runtime values</inline-display>
  </performance-requirements>
</wallaby-first-enforcement>