---
task_id: 011
name: Document mocking policies
description:
  Create comprehensive documentation for mocking policies and guidelines
status: todo
priority: high
tags: documentation, mocking, policy
created: 2025-09-20T03:22:42Z
---

# Task 011: Document mocking policies

## Description

Create comprehensive documentation that clearly defines when to mock, when not
to mock, and which technical solutions to use for different scenarios.

## Acceptance Criteria

- [ ] Define trust boundary concept
- [ ] Create decision flowchart for mocking
- [ ] Document approved mocking scenarios
- [ ] Provide anti-patterns and examples
- [ ] Create quick reference guide

## Technical Details

### File: `docs/testing/mocking-policy.md`

```markdown
# Mocking Policy

## Core Principles

1. Mock only at trust boundaries
2. Never mock your own domain code
3. If >2 mocks or >3 spy assertions â†’ promote to integration

## Decision Matrix

| Scenario    | Unit Test          | Integration Test   | E2E Test     |
| ----------- | ------------------ | ------------------ | ------------ |
| HTTP/API    | MSW                | Real/MSW           | Stub 3P only |
| Database    | SQLite/convex-test | Testcontainers     | Real         |
| CLI         | Stub child_process | Real in sandbox    | Real         |
| File System | memfs/stub         | tmp dirs           | Real         |
| Time        | Fake timers        | Fake timers        | Real         |
| Random      | Stub Math.random   | Deterministic seed | Real         |
```

### Documentation Sections

- Philosophy and rationale
- Trust boundary definition
- Scenario-specific guidance
- Code examples for each pattern
- Migration guide from over-mocked tests

## Implementation Notes

- Include visual diagrams
- Provide code snippets for each scenario
- Create checklist for code reviews
- Include performance implications
- Add troubleshooting section
