---
task_id: 005
name: Establish Convex test harness
description: Create testing utilities for Convex functions and backend
status: closed
priority: high
tags: convex, backend, testing
created: 2025-09-20T03:22:42Z
updated: 2025-09-20T04:53:45Z
---

# Task 005: Establish Convex test harness

## Description

Set up the Convex test harness using convex-test library for unit testing Convex
functions without requiring a real backend.

## Acceptance Criteria

- [ ] Configure convex-test harness
- [ ] Create test context builders
- [ ] Implement mock authentication helpers
- [ ] Set up test database utilities
- [ ] Create query/mutation test helpers

## Technical Details

### File: `packages/testkit/src/convex/harness.ts`

```typescript
import { convexTest } from 'convex-test'

export function createConvexTestContext() {
  const t = convexTest()

  return {
    context: t,
    withAuth: (userId: string) => t.withIdentity({ subject: userId }),
    withDb: (data: any) =>
      t.run(async (ctx) => {
        // Seed test data
      }),
  }
}
```

### Features to Implement

- Mock user authentication
- Test data factories
- Query result assertions
- Mutation side-effect validation
- Subscription testing utilities

## Implementation Notes

- Support both authenticated and anonymous contexts
- Provide type-safe test data builders
- Enable time manipulation for scheduled functions
- Create helpers for testing real-time features
- Document patterns for testing Convex actions vs mutations
