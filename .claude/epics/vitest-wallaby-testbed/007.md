---
task_id: 007
name: Implement fake timers utilities
description: Create utilities for controlling time in tests
status: todo
priority: medium
tags: mocking, time, utilities
created: 2025-09-20T03:22:42Z
---

# Task 007: Implement fake timers utilities

## Description

Create comprehensive utilities for manipulating time in tests, including fake
timers, system time control, and date mocking.

## Acceptance Criteria

- [ ] Implement fake timer wrappers
- [ ] Create system time manipulation helpers
- [ ] Add time advancement utilities
- [ ] Provide cleanup mechanisms
- [ ] Create common time-based test scenarios

## Technical Details

### File: `packages/testkit/src/env/fake-time.ts`

```typescript
import { vi } from 'vitest'

export const timeHelpers = {
  useFakeTimers: () => {
    vi.useFakeTimers()
    return {
      advance: (ms: number) => vi.advanceTimersByTime(ms),
      runAll: () => vi.runAllTimers(),
      restore: () => vi.useRealTimers(),
    }
  },

  setSystemTime: (date: Date | string | number) => {
    vi.setSystemTime(date)
  },

  mockNow: (timestamp: number) => {
    vi.spyOn(Date, 'now').mockReturnValue(timestamp)
  },
}
```

### Features to Implement

- Timer advancement strategies
- Async timer handling
- Date formatting utilities
- Timezone testing helpers
- Relative time helpers (e.g., "2 hours from now")

## Implementation Notes

- Always restore timers in afterEach hooks
- Provide helpers for common scenarios (timeout testing, debounce, throttle)
- Document interaction with async operations
- Consider timezone implications
- Create patterns for testing scheduled jobs
