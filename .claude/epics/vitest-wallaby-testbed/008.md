---
task_id: 008
name: Create randomness control utilities
description: Implement utilities for deterministic random values in tests
status: todo
priority: medium
tags: mocking, random, deterministic
created: 2025-09-20T03:22:42Z
---

# Task 008: Create randomness control utilities

## Description

Create utilities for controlling random number generation, UUIDs, and other sources of non-determinism in tests.

## Acceptance Criteria

- [ ] Mock Math.random with deterministic values
- [ ] Control crypto.randomUUID generation
- [ ] Provide seeded random generators
- [ ] Create predictable ID generators
- [ ] Implement cleanup and restoration

## Technical Details

### File: `packages/testkit/src/env/random.ts`
```typescript
import { vi } from 'vitest'

export const randomHelpers = {
  mockRandom: (value: number = 0.5) => {
    return vi.spyOn(Math, 'random').mockReturnValue(value)
  },

  mockRandomSequence: (values: number[]) => {
    let index = 0
    return vi.spyOn(Math, 'random').mockImplementation(() => {
      const value = values[index % values.length]
      index++
      return value
    })
  },

  mockUUID: (uuid: string) => {
    return vi.spyOn(crypto, 'randomUUID').mockReturnValue(uuid)
  },

  createSeededRandom: (seed: number) => {
    // Implement seeded PRNG
  }
}
```

### Features to Implement
- Sequential UUID generator
- Predictable shuffle functions
- Deterministic sampling
- Seeded noise generation
- Test data generators with seeds

## Implementation Notes

- Always restore original functions after tests
- Provide both single-value and sequence mocks
- Document impact on cryptographic functions
- Consider library-specific random functions
- Create helpers for common randomization scenarios