---
task_id: 003
name: Create Testcontainers helpers for Postgres
description:
  Implement utilities for spinning up Postgres containers in integration tests
status: todo
priority: high
tags: database, postgres, testcontainers
created: 2025-09-20T03:22:42Z
---

# Task 003: Create Testcontainers helpers for Postgres

## Description

Implement helper utilities for managing Postgres containers during integration
tests using Testcontainers library.

## Acceptance Criteria

- [ ] Create Postgres container factory function
- [ ] Implement connection string builder
- [ ] Add database initialization helpers
- [ ] Create cleanup and teardown utilities
- [ ] Ensure proper resource management

## Technical Details

### File: `packages/testkit/src/containers/postgres.ts`

```typescript
import { PostgreSqlContainer } from '@testcontainers/postgresql'

export async function createPostgresContainer() {
  const container = await new PostgreSqlContainer()
    .withDatabase('test_db')
    .withUsername('test_user')
    .withPassword('test_pass')
    .start()

  return {
    container,
    connectionString: container.getConnectionUri(),
    stop: () => container.stop(),
  }
}
```

### Features to Implement

- Connection pooling configuration
- Migration runner integration
- Seed data helpers
- Transaction rollback between tests
- Health check utilities

## Implementation Notes

- Default to PostgreSQL 15 or latest stable
- Provide timeout configuration (default 30s)
- Support custom initialization scripts
- Ensure containers are properly stopped in afterAll hooks
- Consider connection pool size for parallel tests
