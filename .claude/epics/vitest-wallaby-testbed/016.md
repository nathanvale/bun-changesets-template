---
name: Unify runner configuration
status: open
created: 2025-09-20T21:07:43Z
updated: 2025-09-21T00:00:00Z
github: # Will be updated when synced to GitHub
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Unify runner configuration

## Description

Eliminate configuration divergence between Wallaby (using root vitest.config.ts)
and testkit (using package-level config). Ensure consistent lifecycle hooks,
timeouts, and environment settings across all test runners.

## Acceptance Criteria

- [ ] Wallaby honors package-level vitest.config.ts
- [ ] OR root config loads package-level setupFiles/timeouts
- [ ] Consistent test environment (node vs happy-dom) across runners
- [ ] Timeouts properly configured for both local and CI environments
- [ ] Setup files executed in same order for all runners
- [ ] No environment-based test behavior differences
- [ ] CI reporters unified (junit, html, text-summary) and output to
      ./test-results/

## Technical Details

- Analyze current config differences
- Decide on single source of truth approach
- Update Wallaby configuration to use package config
- Or enhance root config to be package-aware
- Ensure environment detection works consistently
- Ensure setupFiles path resolution is identical across root and package configs
- Document how to run locally vs CI and expected reporters

Key files affected:

- `vitest.config.ts` (root)
- `packages/testkit/vitest.config.ts`
- `wallaby.cjs` configuration (root and any package-level files)
- Environment detection logic

## Dependencies

- [ ] No task dependencies - can be done independently
- [ ] Understanding of Wallaby config options

## Effort Estimate

- Size: M
- Hours: 6-8
- Parallel: true (independent of mock refactoring)

## Definition of Done

- [ ] Single configuration approach chosen
- [ ] Wallaby and Vitest use same config settings
- [ ] Timeouts consistent across environments
- [ ] Setup files load in same order
- [ ] Tests pass in both Wallaby and Vitest
- [ ] No environment-specific flakes
- [ ] Configuration documented
- [ ] CI outputs verified at ./test-results/ with unified reporters
