---
id: 009
title: Rename 18 .unit.test.ts files to .test.ts
epic: test-suite-optimization
status: ready
priority: medium
depends_on: ["008"]
parallel: []
estimated_hours: 2
labels:
  - refactoring
  - naming-conventions
  - test-organization
---

# Task 009: Rename 18 .unit.test.ts files to .test.ts

## Objective

Standardize test file naming by renaming all `.unit.test.ts` files to `.test.ts` for consistency and simplicity.

## Background

The codebase has 18 files using the `.unit.test.ts` pattern mixed with files using `.test.ts`. This inconsistency creates confusion and complicates tool configuration. We're standardizing on `.test.ts` for unit tests.

## Requirements

### Must Have
- [ ] Identify all .unit.test.ts files
- [ ] Rename files to .test.ts pattern
- [ ] Update git history properly
- [ ] Verify no broken imports
- [ ] Confirm all tests still run

### Nice to Have
- [ ] Automated script for future use
- [ ] Update documentation
- [ ] Update VS Code settings

## Implementation Details

### Step 1: Identify all .unit.test.ts files
```bash
# Find all files to be renamed
find . -name "*.unit.test.ts" -type f | sort > files-to-rename.txt

# Count them
wc -l files-to-rename.txt
# Should be 18 files
```

### Step 2: Create rename script
Create `scripts/rename-unit-tests.sh`:
```bash
#!/bin/bash

set -e

echo "Renaming .unit.test.ts files to .test.ts"
echo "========================================"

# Find all .unit.test.ts files
files=$(find . -name "*.unit.test.ts" -type f | grep -v node_modules)

if [ -z "$files" ]; then
  echo "No .unit.test.ts files found"
  exit 0
fi

count=$(echo "$files" | wc -l | tr -d ' ')
echo "Found $count files to rename"

# Rename each file
for file in $files; do
  newname="${file%.unit.test.ts}.test.ts"
  echo "Renaming: $file -> $newname"

  # Use git mv to preserve history
  git mv "$file" "$newname"
done

echo ""
echo "‚úÖ Renamed $count files successfully"

# Show git status
echo ""
echo "Git status:"
git status --short
```

### Step 3: Create Node.js version for safety
Create `scripts/rename-unit-tests.js`:
```javascript
#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');
const glob = require('glob');

class TestFileRenamer {
  constructor() {
    this.dryRun = process.argv.includes('--dry-run');
    this.renamedFiles = [];
  }

  async run() {
    console.log('Test File Renaming Tool');
    console.log('======================');

    if (this.dryRun) {
      console.log('üîç DRY RUN MODE - No files will be changed\n');
    }

    // Find all .unit.test.ts files
    const files = glob.sync('**/*.unit.test.ts', {
      ignore: ['**/node_modules/**', '**/dist/**', '**/build/**']
    });

    if (files.length === 0) {
      console.log('‚úÖ No .unit.test.ts files found');
      return;
    }

    console.log(`Found ${files.length} files to rename:\n`);

    // Process each file
    for (const file of files) {
      const newName = file.replace('.unit.test.ts', '.test.ts');
      console.log(`  ${file} ‚Üí ${newName}`);

      if (!this.dryRun) {
        try {
          // Use git mv to preserve history
          execSync(`git mv "${file}" "${newName}"`, { stdio: 'pipe' });
          this.renamedFiles.push({ old: file, new: newName });
        } catch (error) {
          // Fallback to regular rename if not in git
          fs.renameSync(file, newName);
          this.renamedFiles.push({ old: file, new: newName });
        }
      }
    }

    if (!this.dryRun) {
      console.log(`\n‚úÖ Successfully renamed ${this.renamedFiles.length} files`);
      this.updateReferences();
      this.verifyTests();
    }
  }

  updateReferences() {
    console.log('\nüìù Checking for import references to update...');

    // Find files that might import the renamed test files
    const sourceFiles = glob.sync('**/*.{ts,tsx,js,jsx}', {
      ignore: ['**/node_modules/**', '**/dist/**', '**/build/**']
    });

    let updatedCount = 0;

    for (const file of sourceFiles) {
      let content = fs.readFileSync(file, 'utf8');
      let modified = false;

      for (const rename of this.renamedFiles) {
        const oldImport = rename.old.replace('.ts', '');
        const newImport = rename.new.replace('.ts', '');

        if (content.includes(oldImport)) {
          content = content.replace(new RegExp(oldImport, 'g'), newImport);
          modified = true;
        }
      }

      if (modified) {
        fs.writeFileSync(file, content);
        updatedCount++;
      }
    }

    if (updatedCount > 0) {
      console.log(`  Updated imports in ${updatedCount} files`);
    } else {
      console.log('  No import updates needed');
    }
  }

  verifyTests() {
    console.log('\nüß™ Verifying tests still run...');

    try {
      // Run a quick test to ensure nothing is broken
      execSync('pnpm test --run --reporter=dot', {
        stdio: 'inherit',
        timeout: 30000
      });
      console.log('‚úÖ All tests pass with new file names');
    } catch (error) {
      console.error('‚ùå Tests failed after renaming');
      console.error('Consider reverting with: git checkout -- .');
      process.exit(1);
    }
  }
}

// Run if executed directly
if (require.main === module) {
  const renamer = new TestFileRenamer();
  renamer.run().catch(console.error);
}

module.exports = TestFileRenamer;
```

### Step 4: Update configuration files
After renaming, update relevant configs:

1. **Wallaby configuration** (`wallaby.js`):
```javascript
module.exports = function() {
  return {
    files: [
      'src/**/*.ts',
      '!src/**/*.test.ts', // Updated pattern
      '!src/**/*.integration.test.ts',
      '!src/**/*.e2e.test.ts'
    ],
    tests: [
      'src/**/*.test.ts' // Updated pattern
    ]
  };
};
```

2. **VS Code settings** (`.vscode/settings.json`):
```json
{
  "files.associations": {
    "*.test.ts": "typescript",
    "*.integration.test.ts": "typescript",
    "*.e2e.test.ts": "typescript"
  },
  "testExplorer.testFilePattern": "**/*.{test,integration.test,e2e.test}.ts"
}
```

3. **ESLint config** if needed:
```javascript
{
  overrides: [
    {
      files: ['*.test.ts', '*.integration.test.ts', '*.e2e.test.ts'],
      rules: {
        // Test-specific rules
      }
    }
  ]
}
```

### Step 5: Create rollback plan
Document rollback procedure:
```bash
# If something goes wrong, revert the rename:
git reset --hard HEAD~1

# Or revert specific files:
git checkout -- .

# Or manually rename back:
for file in $(find . -name "*.test.ts"); do
  if [[ ! "$file" =~ \.(integration|e2e)\.test\.ts$ ]]; then
    git mv "$file" "${file%.test.ts}.unit.test.ts"
  fi
done
```

## Acceptance Criteria

- [ ] All 18 .unit.test.ts files renamed to .test.ts
- [ ] Git history preserved for all renamed files
- [ ] All tests still pass after renaming
- [ ] Configuration files updated
- [ ] No broken imports or references

## Testing

- Run rename script in dry-run mode first
- Verify file count matches expectation (18)
- Run full test suite after renaming
- Check git log shows rename operations
- Verify Wallaby picks up renamed files

## Risks

- May break imports if files are referenced elsewhere
- Git history could be lost if not done properly
- Tool configurations may need updating

## Dependencies

- Git for preserving file history
- Test runner must be working
- No ongoing changes to affected files

## Notes

This is a straightforward refactoring task but must be done carefully to preserve git history and ensure no breakage.