---
name: Eliminate console output mocking (target: -150 mocks)
status: open
created: 2025-09-20T01:15:53Z
updated: 2025-09-20T01:15:53Z
github: [Will be updated when synced to GitHub]
depends_on: [006, 010]
parallel: true
conflicts_with: []
---

# Task 012: Eliminate console output mocking (target: -150 mocks)

## Description

Eliminate approximately 150 console output mocks across the codebase by
replacing them with proper test utilities and assertions. Console mocking is
often unnecessary and can be replaced with output capturing mechanisms or by
testing the actual behavior instead of implementation details.

This task focuses on removing mocks of `console.log`, `console.error`,
`console.warn`, and related output methods, replacing them with more robust
testing approaches that don't rely on mocking implementation details.

## Acceptance Criteria

1. **Console Mock Elimination**
   - [ ] Remove all unnecessary console.log/error/warn mocks (~150 targets)
   - [ ] Replace with output capturing where console output verification is
         essential
   - [ ] Convert console-dependent tests to behavior-based assertions
   - [ ] Maintain test coverage while improving test quality

2. **Proper Test Utilities**
   - [ ] Implement stdout/stderr capturing utilities where needed
   - [ ] Create test helpers for output verification
   - [ ] Establish patterns for testing logging behavior
   - [ ] Document approved console testing approaches

3. **Test Quality Improvement**
   - [ ] Focus tests on actual behavior rather than console calls
   - [ ] Improve test reliability by removing mock brittleness
   - [ ] Enhance test readability with clearer assertions
   - [ ] Reduce test maintenance overhead

4. **Documentation and Guidelines**
   - [ ] Document when console testing is appropriate
   - [ ] Provide examples of proper console testing patterns
   - [ ] Create guidelines for avoiding console mocks
   - [ ] Update team testing standards

## Technical Details

### Console Mock Patterns to Eliminate

1. **Simple Console Mocks**

   ```typescript
   // BEFORE - Remove these patterns
   const consoleSpy = vi.spyOn(console, 'log').mockImplementation()
   vi.spyOn(console, 'error').mockImplementation(() => {})
   jest.spyOn(console, 'warn').mockReturnValue(undefined)
   ```

2. **Console Output Verification**

   ```typescript
   // BEFORE - Brittle console mocking
   const logSpy = vi.spyOn(console, 'log')
   doSomething()
   expect(logSpy).toHaveBeenCalledWith('expected message')

   // AFTER - Behavior-based testing
   const result = doSomething()
   expect(result.messages).toContain('expected message')
   ```

3. **Error Logging Mocks**

   ```typescript
   // BEFORE - Mocking error console
   const errorSpy = vi.spyOn(console, 'error').mockImplementation()

   // AFTER - Test the actual error handling
   expect(() => doSomething()).toThrow('expected error')
   ```

### Replacement Strategies

1. **Output Capturing Utilities**

   ```typescript
   // Create reusable output capture utilities
   export function captureConsoleOutput<T>(fn: () => T): {
     result: T
     stdout: string[]
     stderr: string[]
   } {
     const stdout: string[] = []
     const stderr: string[] = []

     const originalLog = console.log
     const originalError = console.error

     console.log = (...args) => stdout.push(args.join(' '))
     console.error = (...args) => stderr.push(args.join(' '))

     try {
       const result = fn()
       return { result, stdout, stderr }
     } finally {
       console.log = originalLog
       console.error = originalError
     }
   }
   ```

2. **Behavior-Based Testing**

   ```typescript
   // Focus on actual behavior instead of console calls
   test('logs validation errors', () => {
     const result = validateInput(invalidData)
     expect(result.errors).toContain('Invalid email format')
     expect(result.isValid).toBe(false)
   })
   ```

3. **Logger Interface Testing**
   ```typescript
   // Test through logger interfaces, not console directly
   const mockLogger = { log: vi.fn(), error: vi.fn() }
   const service = new Service(mockLogger)
   service.doSomething()
   expect(mockLogger.log).toHaveBeenCalledWith('operation completed')
   ```

### Implementation Approach

1. **Audit and Categorization**
   - Identify all console mocks in the codebase
   - Categorize by purpose (debugging, error logging, user feedback)
   - Determine which require output verification vs behavior testing

2. **Utility Development**
   - Create console output capturing utilities
   - Develop test helpers for common logging scenarios
   - Establish patterns for different logging types

3. **Progressive Replacement**
   - Start with simple console.log mocks
   - Progress to error and warning mocks
   - Handle complex multi-console scenarios last

4. **Validation and Testing**
   - Ensure no regression in test coverage
   - Verify improved test reliability
   - Validate performance improvements

## Dependencies

- **Task 006**: Improved test utilities must be available
- **Task 010**: Mock tracking tools needed to measure progress
- **No Conflicts**: Console mocking changes are isolated and safe for parallel
  execution

## Effort Estimate

**Size**: Large (3 days)

**Breakdown**:

- Day 1: Audit console mocks and create replacement utilities
- Day 2: Replace 70% of console mocks with proper alternatives
- Day 3: Complete remaining mocks and validate changes

**Skills Required**:

- Test refactoring expertise
- Console/output handling knowledge
- Pattern recognition and replacement
- Test utility development

## Definition of Done

1. **Mock Reduction Achievement**
   - Eliminate 150+ console output mocks from codebase
   - Replace with appropriate testing utilities or behavior assertions
   - Maintain or improve test coverage
   - Document all changes and rationale

2. **Improved Test Quality**
   - Tests focus on behavior rather than implementation details
   - Reduced test brittleness from mock dependencies
   - Enhanced test readability and maintainability
   - Faster test execution without unnecessary mocking overhead

3. **Utility Infrastructure**
   - Reusable console output capturing utilities
   - Documented patterns for console testing
   - Test helpers for common logging scenarios
   - Integration with existing test framework

4. **Documentation and Standards**
   - Updated testing guidelines for console output
   - Examples of proper console testing patterns
   - Migration guide for future console mock elimination
   - Team training materials on new approaches

5. **Measurement and Validation**
   - Confirmed reduction of 150+ console mocks
   - Test suite performance improvement measurement
   - No regression in test coverage or reliability
   - Integration with mock tracking system from Task 010

The implementation must demonstrate that console output can be effectively
tested without extensive mocking, providing a model for similar simplifications
across the codebase.
