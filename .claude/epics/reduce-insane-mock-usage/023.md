# Task 023: Replace database mocking with SQLite integration tests

**Epic:** reduce-insane-mock-usage **Phase:** Phase 3 - Architecture
Transformation **Created:** 2025-09-20T02:15:00Z **Updated:**
2025-09-20T02:15:00Z **Status:** pending **Size:** Large **Parallel:** true
**Depends on:** [004, 021]

## Objective

Replace all database mocking with SQLite-based integration tests that use real
database operations while maintaining test performance and isolation through
in-memory databases.

## Success Criteria

- [ ] All database mocks removed from tests
- [ ] SQLite in-memory databases used for test isolation
- [ ] Database schema migrations work in test environment
- [ ] Repository pattern tests use real database operations
- [ ] Test data setup/teardown properly implemented
- [ ] Performance comparable to or better than mocked tests

## Tasks

1. **Setup SQLite test infrastructure**
   - Configure SQLite in-memory databases for tests
   - Implement database schema creation for tests
   - Create database connection management for test isolation

2. **Convert repository tests**
   - Replace repository mocks with real SQLite operations
   - Test actual SQL queries and data persistence
   - Verify database constraints and relationships

3. **Convert service layer tests**
   - Update service tests to use real database through repositories
   - Test transaction handling and rollback scenarios
   - Verify data consistency across service operations

4. **Implement test data builders**
   - Create builders for consistent test data creation
   - Implement database seeding utilities
   - Add helpers for complex data relationship setup

5. **Add database migration testing**
   - Test schema migrations work correctly
   - Verify data preservation during migrations
   - Test migration rollback scenarios

## Architecture Impact

- Eliminates fragile database mocks
- Provides confidence in actual SQL queries
- Enables testing of database constraints and relationships
- Validates transaction handling and data consistency

## Testing Strategy

- In-memory SQLite for fast test execution
- Test database isolation to prevent test interdependency
- Performance monitoring to ensure acceptable test speeds
- Database constraint testing for data integrity validation

## Notes

- Depends on repository adapters from task 021
- SQLite provides real SQL testing without external database dependencies
- Focus on maintaining fast test execution through in-memory databases
