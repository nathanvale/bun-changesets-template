---
name: Update existing tests to follow new patterns
status: open
created: 2025-09-20T01:15:53Z
updated: 2025-09-20T01:15:53Z
github: [Will be updated when synced to GitHub]
depends_on: [027, 028, 029]
parallel: false
conflicts_with: []
---

# Task 030: Update existing tests to follow new patterns

## Description

Apply the new testing patterns to all remaining legacy tests in the codebase,
ensuring consistent adoption of boundary mocking, integration patterns, and
fixture library usage throughout the test suite.

## Acceptance Criteria

- [ ] All legacy tests updated to use new patterns
- [ ] Consistent fixture library usage across test suite
- [ ] Integration test patterns applied where appropriate
- [ ] Boundary mocking correctly implemented
- [ ] Test execution time within performance targets
- [ ] Test coverage maintained or improved
- [ ] Documentation updated with migration examples

## Technical Details

### Migration Checklist Per Test File

```typescript
// Before: Legacy test with excessive mocking
describe('UserService', () => {
  const mockUserRepo = jest.fn();
  const mockEmailService = jest.fn();
  const mockValidator = jest.fn();
  const mockLogger = jest.fn();
  const mockCache = jest.fn();

  // After: Boundary mocking with real implementations
  describe('UserService', () => {
    let testEnv: TestEnvironment;
    let userService: UserService;

    beforeEach(async () => {
      testEnv = await TestEnvironment.setupIntegration();
      userService = new UserService(
        new UserRepository(testEnv.db),
        testEnv.adapters.email, // Fake adapter at boundary
        new UserValidator(), // Real implementation
        new Logger(testEnv.adapters.logging), // Real with fake adapter
        new Cache(testEnv.adapters.cache) // Real with fake adapter
      );
    });
  });
}
```

### Migration Areas

- **Service Layer Tests**: Replace repository mocks with real repositories
- **Repository Tests**: Use SQLite instead of database mocks
- **Controller Tests**: Use real services with fake external adapters
- **Utility Tests**: Remove unnecessary mocks
- **Integration Tests**: Consolidate and optimize existing patterns

### Quality Assurance

- Automated migration validation
- Performance regression testing
- Coverage impact analysis
- Test reliability verification

## Dependencies

- **Task 027**: Mock boundary application (provides compliant foundation)
- **Task 028**: Test fixture library (provides reusable patterns)
- **Task 029**: Promotion rule validation (ensures compliance)

## Effort Estimate

**Size**: Large (3 days)

**Breakdown**:

- Day 1: Migrate service and repository layer tests
- Day 2: Migrate controller and utility tests
- Day 3: Performance optimization and final validation

## Definition of Done

- [ ] All legacy tests migrated to new patterns
- [ ] Fixture library consistently used across test suite
- [ ] Integration patterns properly applied
- [ ] Boundary mocking correctly implemented
- [ ] Performance targets met for test execution
- [ ] Test coverage reports show improvement or maintenance
- [ ] Migration documentation with before/after examples available
