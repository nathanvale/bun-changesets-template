---
name: Move existing test files to test-legacy folders for safe preservation
status: open
created: 2025-09-20T01:37:50Z
updated: 2025-09-20T01:37:50Z
github: [Will be updated when synced to GitHub]
depends_on: [000.1]
parallel: false
conflicts_with: []
---

# Task 000.2: Move existing test files to test-legacy folders for safe preservation

## Description

Safely migrate all existing test files from their current locations to the newly created test-legacy directories across the monorepo. This critical migration must preserve git history, maintain file integrity, and ensure no tests are lost during the transition.

This task completes the legacy preservation phase, making way for the implementation of the new test tier structure without risk of losing existing test coverage.

## Acceptance Criteria

1. **Complete test file migration**
   - [ ] All test files moved from original locations to test-legacy directories
   - [ ] Directory structure preserved within test-legacy folders
   - [ ] No test files left in original locations

2. **Git history preservation**
   - [ ] Use `git mv` commands to maintain file history where possible
   - [ ] Commit strategy preserves blame and log information
   - [ ] Clear commit messages documenting the migration

3. **File integrity verification**
   - [ ] All test files successfully moved without corruption
   - [ ] File permissions maintained
   - [ ] Test runner can still execute tests from new locations

4. **Configuration updates**
   - [ ] Test runner configurations updated to point to test-legacy directories
   - [ ] Package.json test scripts updated as needed
   - [ ] CI/CD configurations updated to run legacy tests

5. **Validation and testing**
   - [ ] All migrated tests can still execute successfully
   - [ ] Test coverage maintained or improved
   - [ ] No broken imports or path references

## Technical Details

### Migration Strategy

1. **Pre-migration validation**
   ```bash
   # Verify test execution before migration
   pnpm test
   # Document current test coverage
   pnpm test:coverage
   ```

2. **File migration approach**
   ```bash
   # Use git mv to preserve history
   git mv src/__tests__/* test-legacy/src/__tests__/
   git mv test/* test-legacy/test/
   ```

3. **Structure preservation**
   - Maintain relative directory structure within test-legacy
   - Keep test files grouped by their original organization
   - Preserve any custom test configurations or setups

### Migration Order
1. **Root level tests** (if any)
2. **Package tests by dependency order** (dependencies first)
3. **Shared test utilities and helpers**
4. **Configuration files** (vitest.config.*, setupTests.*, etc.)

### Files to Migrate
- All `*.test.*` files
- All `*.spec.*` files
- `__tests__/` directories and contents
- `test/` and `tests/` directories and contents
- `__mocks__/` directories and contents
- Test configuration files
- Test setup and utility files

### Configuration Updates Required
1. **Vitest/Jest configuration paths**
   ```javascript
   // Update test file patterns
   testMatch: ['test-legacy/**/*.test.*']
   ```

2. **Package.json scripts**
   ```json
   {
     "scripts": {
       "test:legacy": "vitest test-legacy",
       "test": "echo 'New test structure not yet implemented'"
     }
   }
   ```

3. **CI/CD pipeline updates**
   - Update test execution paths
   - Ensure coverage reporting includes legacy tests
   - Maintain existing test gates and requirements

## Dependencies

- **Task 000.1**: test-legacy directories must exist
- **Task 000**: Audit results inform migration strategy and scope

## Effort Estimate

**Size**: Medium
**Duration**: 2 days
**Complexity**: Medium to High

### Time Breakdown
- Migration planning and scripting: 4 hours
- File migration execution: 6 hours
- Configuration updates: 4 hours
- Validation and testing: 4 hours
- Documentation and cleanup: 2 hours

### Risk Factors
- File corruption during migration
- Git history loss if not handled properly
- Broken test configurations requiring debugging
- Import path updates needed across multiple files

## Definition of Done

1. **Migration completion verified**:
   - Zero test files remain in original locations
   - All test files successfully moved to test-legacy directories
   - File integrity validated with checksums or git verification

2. **Functionality maintained**:
   - All legacy tests execute successfully from new locations
   - Test coverage metrics match or exceed pre-migration levels
   - CI/CD pipelines execute without errors

3. **Configuration consistency**:
   - All test runners point to correct test-legacy paths
   - Package.json scripts updated and functional
   - Development workflow uninterrupted

4. **Git history preservation**:
   - File history maintained for all migrated test files
   - Clear migration commits with descriptive messages
   - Git blame and log functionality intact

5. **Documentation and communication**:
   - Migration completion documented
   - Team notified of new test locations
   - Clear instructions for accessing legacy tests during transition

## Notes

### Critical Considerations
- **This is a one-way migration** - plan carefully and validate thoroughly
- **Parallel execution disabled** due to file system conflicts and git operations
- **Create comprehensive backup** before beginning migration
- **Test execution must work** immediately after migration

### Post-Migration Actions
- Update development documentation
- Notify team of new test locations
- Plan timeline for implementing new test tier structure
- Begin analysis of migrated tests for mock usage patterns

### Rollback Plan
- Keep detailed log of all migration operations
- Maintain backup of original test locations
- Document rollback procedure in case of critical issues
- Test rollback procedure before executing migration