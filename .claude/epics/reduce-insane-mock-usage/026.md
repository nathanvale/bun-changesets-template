---
name: Establish adapter fakes for external services (email, S3, etc.)
status: open
created: 2025-09-20T01:15:53Z
updated: 2025-09-20T01:15:53Z
github: [Will be updated when synced to GitHub]
depends_on: [021]
parallel: true
conflicts_with: []
---

# Task 026: Establish adapter fakes for external services (email, S3, etc.)

## Description

Create fake implementations of external service adapters that provide realistic
behavior for testing without requiring actual external service calls. These
fakes implement the same interfaces as production adapters but use in-memory or
local alternatives.

## Acceptance Criteria

- [ ] Fake implementations for all external service adapters
- [ ] Realistic behavior simulation (delays, errors, state changes)
- [ ] State inspection capabilities for test verification
- [ ] Configuration-driven error injection
- [ ] Performance characteristics similar to real services
- [ ] Thread-safe implementations for concurrent testing
- [ ] Comprehensive logging for debugging

## Technical Details

### Fake Adapter Implementations

```typescript
class FakeEmailAdapter implements EmailAdapter {
  private sentEmails: Email[] = []
  private failureRate: number = 0

  async connect(): Promise<void> {
    // Simulate connection delay
    await this.delay(100)
  }

  async sendEmail(to: string, subject: string, body: string): Promise<void> {
    if (Math.random() < this.failureRate) {
      throw new Error('Email service temporarily unavailable')
    }

    await this.delay(200) // Simulate network delay
    this.sentEmails.push({ to, subject, body, sentAt: new Date() })
  }

  // Test utilities
  getSentEmails(): Email[] {
    return [...this.sentEmails]
  }
  setFailureRate(rate: number): void {
    this.failureRate = rate
  }
  clear(): void {
    this.sentEmails.length = 0
  }
}
```

### Service Categories

- **Email Service**: In-memory email queue with delivery simulation
- **File Storage**: Local filesystem with S3-like API semantics
- **Payment Processing**: Transaction simulation with various outcomes
- **Authentication**: JWT token generation and validation
- **Logging**: Structured log capture and analysis
- **Cache**: In-memory cache with TTL and eviction policies

### Advanced Features

- Configurable latency simulation
- Error rate configuration
- State persistence between tests
- Transaction log for debugging
- Resource usage monitoring

## Dependencies

- **Task 021**: Boundary adapter pattern (provides adapter interfaces)

## Effort Estimate

**Size**: Large (3 days)

**Breakdown**:

- Day 1: Implement core fake adapters (email, storage, payment)
- Day 2: Add advanced features (error injection, latency simulation)
- Day 3: Create test utilities and documentation

## Definition of Done

- [ ] Fake implementations exist for all external service adapters
- [ ] Realistic behavior simulation includes delays and errors
- [ ] State inspection utilities available for test verification
- [ ] Error injection configurable per test scenario
- [ ] Performance characteristics documented and validated
- [ ] Thread safety verified for concurrent test execution
- [ ] Comprehensive documentation with usage examples
