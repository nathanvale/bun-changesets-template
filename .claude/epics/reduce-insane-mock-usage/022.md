# Task 022: Convert file system mocking to temp directory usage

**Epic:** reduce-insane-mock-usage **Phase:** Phase 3 - Architecture
Transformation **Created:** 2025-09-20T02:15:00Z **Updated:**
2025-09-20T02:15:00Z **Status:** pending **Size:** Large **Parallel:** true
**Depends on:** [005, 021]

## Objective

Replace all file system mocking with real file operations using temporary
directories, providing more realistic test scenarios while maintaining test
isolation and performance.

## Success Criteria

- [ ] All `fs` module mocks removed from tests
- [ ] Temporary directory setup/teardown implemented for file tests
- [ ] File operations use real file system through storage adapters
- [ ] Test isolation maintained through unique temp directories
- [ ] Performance benchmarks show acceptable test execution times
- [ ] File cleanup handled properly in all test scenarios

## Tasks

1. **Implement temp directory utilities**
   - Create helper functions for temp directory creation
   - Implement automatic cleanup mechanisms
   - Add error handling for disk space issues

2. **Convert file upload tests**
   - Replace file system mocks with real temp file operations
   - Use storage adapters for file operations
   - Ensure proper file cleanup after tests

3. **Convert file processing tests**
   - Update tests that process files to use real files
   - Create test fixtures as actual files in temp directories
   - Verify file content through real file operations

4. **Convert configuration file tests**
   - Replace config file mocks with real temp config files
   - Test actual file parsing and validation
   - Ensure configuration loading works with real files

5. **Update test utilities**
   - Create shared utilities for temp file/directory management
   - Add helpers for creating test files with specific content
   - Implement cleanup verification to prevent test pollution

## Architecture Impact

- Eliminates brittle file system mocks
- Provides more realistic testing of file operations
- Enables testing of file system edge cases (permissions, disk space)
- Improves confidence in file handling code

## Testing Strategy

- Performance benchmarks to ensure temp file operations don't slow tests
- Test cleanup verification to prevent temp file accumulation
- Cross-platform compatibility testing
- Error scenario testing (disk full, permission denied)

## Notes

- Depends on storage adapters from task 021
- Focus on maintaining test performance while using real files
- Ensure proper cleanup to prevent disk space issues in CI
