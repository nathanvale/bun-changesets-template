---
name: Convert file system mocking to temp directory usage
status: open
created: 2025-09-20T01:15:53Z
updated: 2025-09-20T01:15:53Z
github: [Will be updated when synced to GitHub]
depends_on: [005, 016, 017]
parallel: true
conflicts_with: []
---

# Task 022: Convert file system mocking to temp directory usage

## Description

Replace file system mocking with real temporary directories and file operations.
This provides more realistic testing conditions while maintaining test isolation
and performance.

## Acceptance Criteria

- [ ] All fs mocks replaced with real temporary directories
- [ ] Temporary directory cleanup implemented for each test
- [ ] File operations use real filesystem APIs
- [ ] Test isolation maintained between test runs
- [ ] Performance comparable to mocked implementations
- [ ] Cross-platform compatibility ensured
- [ ] Error scenarios properly tested with real file operations

## Technical Details

### Temporary Directory Management

```typescript
class TempDirectoryManager {
  private tempDir: string

  async setup(): Promise<string> {
    this.tempDir = await fs.mkdtemp(path.join(os.tmpdir(), 'test-'))
    return this.tempDir
  }

  async cleanup(): Promise<void> {
    if (this.tempDir) {
      await fs.rm(this.tempDir, { recursive: true, force: true })
    }
  }
}
```

### Test Fixture Patterns

- Before/after hooks for directory lifecycle
- Shared temp directory utilities
- File structure builders for complex scenarios
- Path resolution helpers

### Areas to Convert

- Configuration file reading/writing tests
- Log file generation and rotation tests
- Cache file management tests
- Template file processing tests
- Build artifact handling tests

## Dependencies

- **Task 005**: Test environment standardization (provides infrastructure)
- **Task 016**: Replace unit mocks with integration patterns (establishes
  approach)
- **Task 017**: Establish promotion rule enforcement (provides guidelines)

## Effort Estimate

**Size**: Large (3 days)

**Breakdown**:

- Day 1: Create temp directory management utilities and patterns
- Day 2: Convert existing fs mocks to temp directory usage
- Day 3: Optimize performance and ensure cross-platform compatibility

## Definition of Done

- [ ] No file system mocks remain in test suite
- [ ] All file operations use real temporary directories
- [ ] Temporary directories properly cleaned up after tests
- [ ] Test isolation verified between concurrent test runs
- [ ] Performance benchmarks meet requirements
- [ ] Cross-platform compatibility tested (Linux, macOS, Windows)
- [ ] Error scenarios covered with real file system errors
