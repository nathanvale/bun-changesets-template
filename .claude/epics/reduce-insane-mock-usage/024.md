# Task 024: Implement HTTP mocking with MSW handlers

**Epic:** reduce-insane-mock-usage **Phase:** Phase 3 - Architecture
Transformation **Created:** 2025-09-20T02:15:00Z **Updated:**
2025-09-20T02:15:00Z **Status:** pending **Size:** Large **Parallel:** true
**Depends on:** [003, 021]

## Objective

Replace brittle HTTP mocking with Mock Service Worker (MSW) handlers that
provide realistic HTTP responses and better test reliability for external API
interactions.

## Success Criteria

- [ ] All HTTP library mocks replaced with MSW handlers
- [ ] MSW configured for both Node.js and browser environments
- [ ] Realistic API response handlers implemented
- [ ] Error scenario testing enabled through MSW
- [ ] HTTP adapter tests use MSW for external service simulation
- [ ] Network error and timeout scenarios properly tested

## Tasks

1. **Setup MSW infrastructure**
   - Install and configure MSW for the project
   - Setup MSW server for Node.js test environment
   - Configure MSW browser setup for frontend tests

2. **Create API response handlers**
   - Implement MSW handlers for all external APIs
   - Create realistic response data structures
   - Add proper HTTP status codes and headers

3. **Convert HTTP client tests**
   - Replace HTTP library mocks with MSW handlers
   - Test actual HTTP requests against MSW endpoints
   - Verify request headers, bodies, and authentication

4. **Implement error scenario handlers**
   - Create handlers for network errors and timeouts
   - Test retry logic and error handling
   - Verify graceful degradation scenarios

5. **Add request verification utilities**
   - Create utilities to verify requests made to MSW handlers
   - Add assertion helpers for request validation
   - Implement request sequence and timing verification

## Architecture Impact

- Provides realistic HTTP testing without external dependencies
- Enables testing of actual HTTP client behavior
- Improves test reliability by eliminating mock configuration complexity
- Supports both success and failure scenario testing

## Testing Strategy

- MSW handlers that closely match real API responses
- Request verification to ensure correct API calls
- Error scenario testing for resilience validation
- Performance testing to ensure MSW doesn't slow tests significantly

## Notes

- Depends on HTTP adapters from task 021
- MSW provides more realistic HTTP testing than traditional mocks
- Focus on creating handlers that match real API behavior closely
