<?xml version="1.0" encoding="UTF-8"?>
<phase_finalization>

  <metadata>
    <phase>3</phase>
    <name>Post-Execution Finalization</name>
    <version>4.0</version>
    <architecture>MASTER_PROTOCOL_REFERENCE</architecture>
  </metadata>

  <important_notice>
    <message>PHASE 3 EXECUTION IS NOW HANDLED IN MASTER PROTOCOL</message>
    <reference>execute-tasks-master.xml contains all Phase 3 logic</reference>
    <instruction>DO NOT execute this file directly - use execute-tasks.xml instead</instruction>
  </important_notice>
  
  <phase3_summary>
    <description>Phase 3 handles post-execution finalization with these concrete steps:</description>
    
    <step1>
      <name>Run Test Suite</name>
      <tool>Bash</tool>
      <command>pnpm test</command>
      <continue_on_failure>true</continue_on_failure>
      <stores>TEST_STATUS variable</stores>
    </step1>
    
    <step2>
      <name>Git Operations</name>
      <sequential_tools>
        <tool1>Bash (git add -A)</tool1>
        <tool2>Bash (git commit with formatted message)</tool2>
        <tool3>Bash (git push origin) - optional</tool3>
      </sequential_tools>
      <creates>Commit with tasks from ${SPEC_FOLDER}</creates>
    </step2>
    
    <step3>
      <name>Verify Completion</name>
      <tool>Read</tool>
      <target>${SPEC_PATH}/tasks.md</target>
      <verification>Confirm no "- [ ]" lines remain</verification>
    </step3>
    
    <step4>
      <name>Create Execution Summary</name>
      <tool>Write</tool>
      <creates>${SPEC_PATH}/execution-recap.md</creates>
      <content>Detailed recap with branch, tasks, files modified, test status</content>
    </step4>
    
    <step5>
      <name>Generate Completion Summary</name>
      <action>Output formatted completion message to user</action>
      <includes>Spec name, branch, task count, test status, file count</includes>
    </step5>
    
    <step6>
      <name>Success Notification</name>
      <tool>Bash</tool>
      <command>afplay sound or echo completion</command>
      <optional>true</optional>
    </step6>
    
  </phase3_summary>

  <completion_criteria>
    <trigger>All 6 steps complete successfully</trigger>
    <signal>Phase 3 completion message in master protocol</signal>
    <final_status>EXECUTION_CYCLE_COMPLETE</final_status>
  </completion_criteria>

  <integration_note>
    <master_file>execute-tasks-master.xml</master_file>
    <section>phase_3_finalization</section>
    <contains>Concrete finalization steps, git workflow, and summary generation</contains>
  </integration_note>

</phase_finalization>